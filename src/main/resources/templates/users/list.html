<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::title}, ~{::section})}">
<head>
    <title>ユーザー一覧 - オーミック ユーザー管理システム</title>
</head>
<body>
    <section>
        <!-- Page Header -->
        <div class="page-header" style="background: var(--bg-gradient); color: var(--text-light); padding: var(--spacing-xl) 0; margin-bottom: var(--spacing-xl);">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="page-title" style="font-size: 2.5rem; font-weight: 700; margin-bottom: var(--spacing-sm);">
                            <i class="fas fa-users me-3" aria-hidden="true"></i>
                            ユーザー管理
                        </h1>
                        <p class="page-subtitle" style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 0;">
                            オーミックのユーザー管理システムで、効率的なユーザー管理を実現
                        </p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div class="user-stats" style="background: rgba(255, 255, 255, 0.1); padding: var(--spacing-md); border-radius: var(--radius-lg); backdrop-filter: blur(10px);">
                            <div class="stat-number" style="font-size: 2rem; font-weight: 700; color: var(--accent-color);">
                                <span th:text="${users.size()}">0</span>
                            </div>
                            <div class="stat-label" style="font-size: 0.9rem; opacity: 0.8;">登録ユーザー</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Action Buttons -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <div class="d-flex gap-3 flex-wrap">
                        <a href="/users/new" class="btn btn-primary" role="button" aria-label="新規ユーザーを追加">
                            <i class="fas fa-user-plus me-2" aria-hidden="true"></i>
                            新規ユーザー追加
                        </a>
                        <a href="/users/batch-create" class="btn btn-accent" role="button" aria-label="一括ユーザー登録">
                            <i class="fas fa-users-cog me-2" aria-hidden="true"></i>
                            一括登録
                        </a>
                        <button class="btn btn-outline-primary" onclick="exportUsers()" aria-label="ユーザーデータをエクスポート">
                            <i class="fas fa-download me-2" aria-hidden="true"></i>
                            エクスポート
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="search-box" style="position: relative;">
                        <input type="text" id="searchInput" class="form-control" placeholder="ユーザーを検索..." 
                               aria-label="ユーザー検索" style="padding-left: 2.5rem;">
                        <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
                    </div>
                </div>
            </div>

            <!-- Users Table -->
            <div class="card" style="border: none; border-radius: var(--radius-lg); box-shadow: 0 4px 20px var(--shadow-light); overflow: hidden;">
                <div class="card-header" style="background: var(--bg-gradient); color: var(--text-light); border: none; padding: var(--spacing-lg);">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h5 class="mb-0" style="font-weight: 600;">
                                <i class="fas fa-list me-2" aria-hidden="true"></i>
                                ユーザー一覧
                            </h5>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <div class="table-controls">
                                <select id="sortSelect" class="form-select form-select-sm d-inline-block w-auto me-2" aria-label="並び替え">
                                    <option value="name">名前順</option>
                                    <option value="email">メール順</option>
                                    <option value="created">登録日順</option>
                                </select>
                                <select id="filterSelect" class="form-select form-select-sm d-inline-block w-auto" aria-label="フィルタ">
                                    <option value="all">すべて</option>
                                    <option value="active">アクティブ</option>
                                    <option value="inactive">非アクティブ</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="usersTable" role="table" aria-label="ユーザー一覧">
                        <thead>
                            <tr>
                                <th scope="col" style="border: none; padding: var(--spacing-lg);">
                                    <i class="fas fa-user me-2" aria-hidden="true"></i>
                                    ユーザー情報
                                </th>
                                <th scope="col" style="border: none; padding: var(--spacing-lg);">
                                    <i class="fas fa-envelope me-2" aria-hidden="true"></i>
                                    メールアドレス
                                </th>
                                <th scope="col" style="border: none; padding: var(--spacing-lg);">
                                    <i class="fas fa-calendar me-2" aria-hidden="true"></i>
                                    登録日
                                </th>
                                <th scope="col" style="border: none; padding: var(--spacing-lg);">
                                    <i class="fas fa-cogs me-2" aria-hidden="true"></i>
                                    操作
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="user : ${users}" th:data-user-id="${user.id}" class="user-row" role="row">
                                <td style="padding: var(--spacing-lg); border-color: var(--border-light);">
                                    <div class="user-info" style="display: flex; align-items: center; gap: var(--spacing-md);">
                                        <div class="user-avatar" style="width: 48px; height: 48px; background: var(--bg-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-light); font-weight: 600; font-size: 1.2rem;">
                                            <span th:text="${#strings.substring(user.name, 0, 1)}">U</span>
                                        </div>
                                        <div class="user-details">
                                            <div class="user-name" style="font-weight: 600; color: var(--text-dark); margin-bottom: var(--spacing-xs);" th:text="${user.name}">ユーザー名</div>
                                            <div class="user-id" style="font-size: 0.9rem; color: var(--text-muted);" th:text="'ID: ' + ${user.id}">ID: 1</div>
                                        </div>
                                    </div>
                                </td>
                                <td style="padding: var(--spacing-lg); border-color: var(--border-light);">
                                    <div class="user-email" style="color: var(--text-dark);" th:text="${user.email}">user@example.com</div>
                                </td>
                                <td style="padding: var(--spacing-lg); border-color: var(--border-light);">
                                    <div class="user-created" style="color: var(--text-muted); font-size: 0.9rem;" th:text="${#temporals.format(user.createdAt, 'yyyy/MM/dd HH:mm')}">2024/01/01 12:00</div>
                                </td>
                                <td style="padding: var(--spacing-lg); border-color: var(--border-light);">
                                    <div class="user-actions" style="display: flex; gap: var(--spacing-sm);">
                                        <a th:href="@{/users/{id}/edit(id=${user.id})}" class="btn btn-sm btn-outline-primary" 
                                           role="button" aria-label="ユーザーを編集" title="編集">
                                            <i class="fas fa-edit" aria-hidden="true"></i>
                                        </a>
                                        <a th:href="@{/users/{id}(id=${user.id})}" class="btn btn-sm btn-outline-info" 
                                           role="button" aria-label="ユーザー詳細を表示" title="詳細">
                                            <i class="fas fa-eye" aria-hidden="true"></i>
                                        </a>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteUser(this)" 
                                                th:data-user-id="${user.id}" th:data-user-name="${user.name}"
                                                role="button" aria-label="ユーザーを削除" title="削除">
                                            <i class="fas fa-trash" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Empty State -->
                <div th:if="${users.empty()}" class="text-center py-5" style="background: var(--bg-secondary);">
                    <div class="empty-state">
                        <i class="fas fa-users" style="font-size: 4rem; color: var(--text-muted); margin-bottom: var(--spacing-lg);"></i>
                        <h4 style="color: var(--text-dark); margin-bottom: var(--spacing-md);">ユーザーが登録されていません</h4>
                        <p style="color: var(--text-muted); margin-bottom: var(--spacing-lg);">
                            最初のユーザーを追加して、オーミックのユーザー管理システムを始めましょう
                        </p>
                        <a href="/users/new" class="btn btn-primary" role="button">
                            <i class="fas fa-user-plus me-2" aria-hidden="true"></i>
                            最初のユーザーを追加
                        </a>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row mt-4">
                <div class="col-md-3">
                    <div class="stat-card" style="background: var(--bg-primary); border-radius: var(--radius-lg); padding: var(--spacing-lg); text-align: center; box-shadow: 0 4px 20px var(--shadow-light); border-left: 4px solid var(--success-color);">
                        <div class="stat-icon" style="width: 60px; height: 60px; background: var(--success-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--spacing-md);">
                            <i class="fas fa-users" style="font-size: 1.5rem; color: var(--text-light);"></i>
                        </div>
                        <div class="stat-number" style="font-size: 2rem; font-weight: 700; color: var(--text-dark);" th:text="${users.size()}">0</div>
                        <div class="stat-label" style="color: var(--text-muted); font-size: 0.9rem;">総ユーザー数</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background: var(--bg-primary); border-radius: var(--radius-lg); padding: var(--spacing-lg); text-align: center; box-shadow: 0 4px 20px var(--shadow-light); border-left: 4px solid var(--info-color);">
                        <div class="stat-icon" style="width: 60px; height: 60px; background: var(--info-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--spacing-md);">
                            <i class="fas fa-user-plus" style="font-size: 1.5rem; color: var(--text-light);"></i>
                        </div>
                        <div class="stat-number" style="font-size: 2rem; font-weight: 700; color: var(--text-dark);" th:text="${#temporals.format(#temporals.createNow(), 'dd')}">01</div>
                        <div class="stat-label" style="color: var(--text-muted); font-size: 0.9rem;">今月の新規登録</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background: var(--bg-primary); border-radius: var(--radius-lg); padding: var(--spacing-lg); text-align: center; box-shadow: 0 4px 20px var(--shadow-light); border-left: 4px solid var(--warning-color);">
                        <div class="stat-icon" style="width: 60px; height: 60px; background: var(--warning-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--spacing-md);">
                            <i class="fas fa-clock" style="font-size: 1.5rem; color: var(--text-light);"></i>
                        </div>
                        <div class="stat-number" style="font-size: 2rem; font-weight: 700; color: var(--text-dark);">24/7</div>
                        <div class="stat-label" style="color: var(--text-muted); font-size: 0.9rem;">サポート時間</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background: var(--bg-primary); border-radius: var(--radius-lg); padding: var(--spacing-lg); text-align: center; box-shadow: 0 4px 20px var(--shadow-light); border-left: 4px solid var(--primary-color);">
                        <div class="stat-icon" style="width: 60px; height: 60px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto var(--spacing-md);">
                            <i class="fas fa-shield-alt" style="font-size: 1.5rem; color: var(--text-light);"></i>
                        </div>
                        <div class="stat-number" style="font-size: 2rem; font-weight: 700; color: var(--text-dark);">99.9%</div>
                        <div class="stat-label" style="color: var(--text-muted); font-size: 0.9rem;">稼働率</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" style="border: none; border-radius: var(--radius-lg);">
                    <div class="modal-header" style="background: var(--bg-gradient); color: var(--text-light); border: none; border-radius: var(--radius-lg) var(--radius-lg) 0 0;">
                        <h5 class="modal-title" id="deleteModalLabel" style="font-weight: 600;">
                            <i class="fas fa-exclamation-triangle me-2" aria-hidden="true"></i>
                            ユーザー削除の確認
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="閉じる"></button>
                    </div>
                    <div class="modal-body" style="padding: var(--spacing-xl);">
                        <p style="color: var(--text-dark); margin-bottom: var(--spacing-lg);">
                            ユーザー「<span id="deleteUserName" style="font-weight: 600; color: var(--danger-color);"></span>」を削除しますか？
                        </p>
                        <p style="color: var(--text-muted); font-size: 0.9rem;">
                            この操作は取り消すことができません。削除されたユーザーデータは完全に削除されます。
                        </p>
                    </div>
                    <div class="modal-footer" style="border: none; padding: var(--spacing-lg) var(--spacing-xl);">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-2" aria-hidden="true"></i>
                            キャンセル
                        </button>
                        <button type="button" class="btn btn-danger" id="confirmDelete">
                            <i class="fas fa-trash me-2" aria-hidden="true"></i>
                            削除する
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .user-row:hover {
                background-color: var(--primary-light) !important;
                transform: translateY(-1px);
                transition: all var(--transition-normal);
            }
            
            .stat-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 30px var(--shadow-medium);
                transition: all var(--transition-normal);
            }
            
            .page-header {
                position: relative;
                overflow: hidden;
            }
            
            .page-header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
                opacity: 0.3;
            }
            
            .user-avatar {
                transition: transform var(--transition-normal);
            }
            
            .user-row:hover .user-avatar {
                transform: scale(1.1);
            }
            
            @media (max-width: 768px) {
                .page-title {
                    font-size: 2rem !important;
                }
                
                .user-actions {
                    flex-direction: column;
                    gap: var(--spacing-xs);
                }
                
                .user-actions .btn {
                    width: 100%;
                }
                
                .stat-card {
                    margin-bottom: var(--spacing-lg);
                }
            }
        </style>

        <script>
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('.user-row');
                
                rows.forEach(row => {
                    const name = row.querySelector('.user-name').textContent.toLowerCase();
                    const email = row.querySelector('.user-email').textContent.toLowerCase();
                    
                    if (name.includes(searchTerm) || email.includes(searchTerm)) {
                        row.style.display = '';
                        row.style.animation = 'fadeIn 0.3s ease';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
            
            // Sort functionality
            document.getElementById('sortSelect').addEventListener('change', function() {
                const sortBy = this.value;
                const tbody = document.querySelector('#usersTable tbody');
                const rows = Array.from(tbody.querySelectorAll('.user-row'));
                
                rows.sort((a, b) => {
                    let aValue, bValue;
                    
                    switch(sortBy) {
                        case 'name':
                            aValue = a.querySelector('.user-name').textContent;
                            bValue = b.querySelector('.user-name').textContent;
                            break;
                        case 'email':
                            aValue = a.querySelector('.user-email').textContent;
                            bValue = b.querySelector('.user-email').textContent;
                            break;
                        case 'created':
                            aValue = a.querySelector('.user-created').textContent;
                            bValue = b.querySelector('.user-created').textContent;
                            break;
                        default:
                            return 0;
                    }
                    
                    return aValue.localeCompare(bValue);
                });
                
                rows.forEach(row => tbody.appendChild(row));
            });
            
            // Delete user functionality
            function deleteUser(button) {
                const userId = button.getAttribute('data-user-id');
                const userName = button.getAttribute('data-user-name');
                
                document.getElementById('deleteUserName').textContent = userName;
                
                const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
                modal.show();
                
                document.getElementById('confirmDelete').onclick = function() {
                    fetch(`/users/${userId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    }).then(response => {
                        if (response.ok) {
                            button.closest('.user-row').remove();
                            modal.hide();
                            
                            // Show success message
                            const alert = document.createElement('div');
                            alert.className = 'alert alert-success alert-dismissible fade show';
                            alert.innerHTML = `
                                <i class="fas fa-check-circle me-2" aria-hidden="true"></i>
                                ユーザー「${userName}」を削除しました
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="閉じる"></button>
                            `;
                            document.querySelector('.container').insertBefore(alert, document.querySelector('.container').firstChild);
                            
                            // Update user count
                            const userCount = document.querySelectorAll('.user-row').length;
                            document.querySelectorAll('.stat-number').forEach(stat => {
                                if (stat.textContent.trim() === document.querySelector('.user-row').length.toString()) {
                                    stat.textContent = userCount;
                                }
                            });
                        }
                    });
                };
            }
            
            // Export functionality
            function exportUsers() {
                const rows = document.querySelectorAll('.user-row');
                let csv = '名前,メールアドレス,登録日\n';
                
                rows.forEach(row => {
                    const name = row.querySelector('.user-name').textContent;
                    const email = row.querySelector('.user-email').textContent;
                    const created = row.querySelector('.user-created').textContent;
                    csv += `"${name}","${email}","${created}"\n`;
                });
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'users_export.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // Add loading animation to buttons
            document.addEventListener('DOMContentLoaded', function() {
                const buttons = document.querySelectorAll('.btn');
                buttons.forEach(button => {
                    button.addEventListener('click', function() {
                        if (!this.classList.contains('btn-close')) {
                            const originalText = this.innerHTML;
                            this.innerHTML = '<span class="loading-spinner me-2"></span>処理中...';
                            this.disabled = true;
                            
                            setTimeout(() => {
                                this.innerHTML = originalText;
                                this.disabled = false;
                            }, 2000);
                        }
                    });
                });
            });
            
            // Add fadeIn animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `;
            document.head.appendChild(style);
        </script>
    </section>
</body>
</html> 